<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Threadline â€” Where answers live</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* â”€â”€ RAINBOW DARK THEME â”€â”€ */
    :root {
      --bg-base:       #07080d;
      --bg-surface:    #0f1017;
      --bg-elevated:   #181921;
      --bg-overlay:    #20212c;
      --border-subtle: #1c1d28;
      --border-def:    #272838;
      --border-strong: #3a3b52;
      --accent:        #a78bfa;
      --accent-hov:    #c4b5fd;
      --accent-muted:  rgba(167,139,250,0.12);
      --accent-border: rgba(167,139,250,0.28);
      --success:       #34d399;
      --success-muted: rgba(52,211,153,0.10);
      --danger:        #f87171;
      --danger-muted:  rgba(248,113,113,0.10);
      --warning:       #fbbf24;
      --text-1:        #f0f1fa;
      --text-2:        #9091a4;
      --text-3:        #55566a;
      --tag-bg:        #1a1b28;
      --tag-text:      #a78bfa;
      --tag-border:    #2d2e45;
      --vote-up:       #34d399;
      --vote-down:     #f87171;
      --vote-ring:     #3a3b52;
      --sh-sm:  0 1px 2px rgba(0,0,0,.5);
      --sh-md:  0 4px 16px rgba(0,0,0,.45), 0 1px 3px rgba(0,0,0,.35);
      --sh-lg:  0 16px 40px rgba(0,0,0,.6), 0 4px 10px rgba(0,0,0,.4);
      /* ğŸŒˆ Rainbow gradients */
      --grad:        linear-gradient(135deg,#f97316,#eab308,#22c55e,#06b6d4,#6366f1,#a855f7,#ec4899);
      --grad-btn:    linear-gradient(90deg,#f97316,#eab308,#22c55e,#06b6d4,#6366f1,#a855f7);
      --grad-nav:    linear-gradient(90deg,#f97316,#facc15,#4ade80,#38bdf8,#818cf8,#e879f9,#fb7185);
      --grad-auth:   linear-gradient(135deg,#1a0a2e 0%,#0a1628 50%,#0a1a0e 100%);
      --r-sm: 4px; --r-md: 8px; --r-lg: 12px; --r-xl: 16px; --r-full: 9999px;
      --font: 'Inter', system-ui, -apple-system, sans-serif;
      --mono: 'JetBrains Mono','Fira Code',monospace;
    }

    /* â”€â”€ LIGHT RAINBOW THEME â”€â”€ */
    .light {
      --bg-base:       #fafafa;
      --bg-surface:    #ffffff;
      --bg-elevated:   #f5f5f8;
      --bg-overlay:    #ffffff;
      --border-subtle: #e8e8f0;
      --border-def:    #dddde8;
      --border-strong: #c0c0d0;
      --accent:        #7c3aed;
      --accent-hov:    #9333ea;
      --accent-muted:  rgba(124,58,237,0.08);
      --accent-border: rgba(124,58,237,0.22);
      --success:       #059669;
      --success-muted: rgba(5,150,105,0.08);
      --danger:        #dc2626;
      --danger-muted:  rgba(220,38,38,0.08);
      --text-1:        #18181b;
      --text-2:        #52525b;
      --text-3:        #a1a1aa;
      --tag-bg:        #f3f0ff;
      --tag-text:      #7c3aed;
      --tag-border:    #ddd6fe;
      --vote-up:       #059669;
      --vote-down:     #dc2626;
      --vote-ring:     #c0c0d0;
      --sh-sm: 0 1px 2px rgba(0,0,0,.06);
      --sh-md: 0 4px 12px rgba(0,0,0,.08), 0 1px 3px rgba(0,0,0,.05);
      --sh-lg: 0 12px 32px rgba(0,0,0,.12), 0 4px 8px rgba(0,0,0,.08);
      --grad:      linear-gradient(135deg,#f97316,#eab308,#22c55e,#06b6d4,#6366f1,#a855f7,#ec4899);
      --grad-btn:  linear-gradient(90deg,#f97316,#eab308,#22c55e,#06b6d4,#6366f1,#a855f7);
      --grad-nav:  linear-gradient(90deg,#f97316,#facc15,#4ade80,#38bdf8,#818cf8,#e879f9,#fb7185);
      --grad-auth: linear-gradient(135deg,#fdf4ff 0%,#eff6ff 50%,#f0fdf4 100%);
    }

    html { background: var(--bg-base); }
    body {
      font-family: var(--font);
      background: var(--bg-base);
      color: var(--text-1);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--grad-btn); border-radius: 3px; }

    /* â”€â”€ ğŸŒˆ RAINBOW KEYFRAMES â”€â”€ */
    @keyframes rainbowShift {
      0%   { background-position: 0%   50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0%   50%; }
    }
    @keyframes rainbowBorder {
      0%,100% { border-color: #f97316; }
      16%     { border-color: #eab308; }
      33%     { border-color: #22c55e; }
      50%     { border-color: #06b6d4; }
      66%     { border-color: #6366f1; }
      83%     { border-color: #a855f7; }
    }
    @keyframes hueRotate {
      from { filter: hue-rotate(0deg); }
      to   { filter: hue-rotate(360deg); }
    }

    /* â”€â”€ PAGE ROUTING â”€â”€ */
    .page { display: none; }
    .page.active { display: block; }

    /* â”€â”€ NAV â”€â”€ */
    nav {
      background: rgba(7,8,13,0.90);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: none;
      position: sticky; top: 0; z-index: 100;
    }
    /* Rainbow bottom border on nav */
    nav::after {
      content: '';
      position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
      background: var(--grad-nav);
      background-size: 200% 100%;
      animation: rainbowShift 4s linear infinite;
    }
    .light nav { background: rgba(250,250,250,0.92); }
    .nav-inner {
      max-width: 1080px; margin: 0 auto; padding: 0 20px;
      display: flex; align-items: center; height: 56px; gap: 10px;
    }
    .nav-brand {
      display: flex; align-items: center; gap: 8px;
      font-weight: 700; font-size: 15px; letter-spacing: -.03em;
      cursor: pointer; text-decoration: none;
      background: var(--grad-nav); background-size: 200% auto;
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; animation: rainbowShift 4s linear infinite;
    }
    .nav-spacer { flex: 1; }
    .nav-right { display: flex; align-items: center; gap: 8px; }
    .nav-user  { display: flex; align-items: center; gap: 8px; }
    .nav-username { font-size: 13px; font-weight: 500; color: var(--text-2); }
    .avatar {
      width: 26px; height: 26px; border-radius: var(--r-full);
      background: var(--grad); color: #fff;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 11px; flex-shrink: 0;
    }
    .theme-toggle {
      width: 30px; height: 30px; border-radius: var(--r-md);
      border: 1px solid var(--border-def); background: var(--bg-elevated);
      color: var(--text-2); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all .15s; flex-shrink: 0;
    }
    .theme-toggle:hover { background: var(--bg-overlay); color: var(--text-1); }
    .btn-logout {
      background: transparent; border: 1px solid var(--border-def);
      color: var(--text-2); padding: 5px 12px; border-radius: var(--r-md);
      font-size: 13px; font-weight: 500; cursor: pointer;
      font-family: var(--font); transition: all .15s;
    }
    .btn-logout:hover { background: var(--bg-elevated); color: var(--text-1); }

    /* â”€â”€ CONTAINER â”€â”€ */
    .container { max-width: 1080px; margin: 0 auto; padding: 28px 20px; }

    /* â”€â”€ BUTTONS â”€â”€ */
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 16px; border-radius: var(--r-md); border: 1px solid transparent;
      font-size: 14px; font-weight: 500; letter-spacing: -.01em;
      cursor: pointer; transition: all .15s; font-family: var(--font);
      text-decoration: none; white-space: nowrap; user-select: none;
    }
    .btn:active:not(:disabled) { transform: scale(.97); }
    .btn:disabled { opacity: .45; cursor: not-allowed; }
    .btn-primary {
      background: var(--grad-btn); color: #fff; font-weight: 600;
      background-size: 200% 100%;
      animation: rainbowShift 3s linear infinite;
      box-shadow: 0 2px 12px rgba(167,139,250,.35), inset 0 1px 0 rgba(255,255,255,.15);
    }
    .btn-primary:hover:not(:disabled) {
      filter: brightness(1.15) saturate(1.2);
      box-shadow: 0 4px 20px rgba(167,139,250,.5);
    }
    .btn-secondary {
      background: var(--bg-elevated); color: var(--text-1); border-color: var(--border-def);
    }
    .btn-secondary:hover:not(:disabled) { background: var(--bg-overlay); border-color: var(--border-strong); }
    .btn-ghost { background: transparent; color: var(--text-2); border-color: transparent; }
    .btn-ghost:hover:not(:disabled) { background: var(--bg-elevated); color: var(--text-1); }
    .btn-outline {
      background: transparent; color: var(--accent); border-color: var(--accent-border);
    }
    .btn-outline:hover:not(:disabled) { background: var(--accent-muted); border-color: var(--accent); }
    .btn-sm { padding: 5px 10px; font-size: 12px; border-radius: var(--r-sm); }
    .btn-full { width: 100%; justify-content: center; }

    /* â”€â”€ FORMS â”€â”€ */
    .form-group { margin-bottom: 16px; }
    .form-label-row {
      display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 6px;
    }
    label { display: block; font-size: 13px; font-weight: 500; color: var(--text-2); }
    label .req { color: var(--danger); margin-left: 2px; }
    .char-count { font-size: 11px; color: var(--text-3); font-family: var(--mono); }
    .char-count.warn { color: var(--warning); }
    input[type=text], input[type=email], textarea {
      width: 100%; background: var(--bg-elevated); border: 1px solid var(--border-def);
      border-radius: var(--r-md); padding: 9px 12px; font-size: 14px;
      font-family: var(--font); color: var(--text-1); outline: none;
      transition: border-color .15s, box-shadow .15s, background .15s;
    }
    input::placeholder, textarea::placeholder { color: var(--text-3); }
    input:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-muted);
      background: var(--bg-surface);
    }
    textarea { resize: vertical; min-height: 120px; line-height: 1.65; }

    /* â”€â”€ ALERTS â”€â”€ */
    .alert {
      padding: 10px 14px; border-radius: var(--r-md); font-size: 13px;
      margin-bottom: 16px; display: none; font-weight: 500; line-height: 1.5;
    }
    .alert.show { display: block; }
    .alert-error   { background: var(--danger-muted);  color: var(--danger);  border: 1px solid rgba(248,113,113,.2); }
    .alert-success { background: var(--success-muted); color: var(--success); border: 1px solid rgba(52,211,153,.2); }

    /* â”€â”€ TAGS â”€â”€ */
    .tag {
      display: inline-flex; align-items: center;
      padding: 2px 8px; border-radius: var(--r-sm); font-size: 11px; font-weight: 600;
      letter-spacing: .01em; cursor: default; transition: all .15s; border: 1px solid transparent;
    }
    /* Rainbow tag colors */
    .tag:nth-child(7n+1) { background:rgba(249,115,22,.15); color:#fb923c; border-color:rgba(249,115,22,.3); }
    .tag:nth-child(7n+2) { background:rgba(234,179,8,.15);  color:#facc15; border-color:rgba(234,179,8,.3); }
    .tag:nth-child(7n+3) { background:rgba(34,197,94,.15);  color:#4ade80; border-color:rgba(34,197,94,.3); }
    .tag:nth-child(7n+4) { background:rgba(6,182,212,.15);  color:#22d3ee; border-color:rgba(6,182,212,.3); }
    .tag:nth-child(7n+5) { background:rgba(99,102,241,.15); color:#818cf8; border-color:rgba(99,102,241,.3); }
    .tag:nth-child(7n+6) { background:rgba(168,85,247,.15); color:#c084fc; border-color:rgba(168,85,247,.3); }
    .tag:nth-child(7n+0) { background:rgba(236,72,153,.15); color:#f472b6; border-color:rgba(236,72,153,.3); }
    .tag:hover { filter: brightness(1.2) saturate(1.3); transform: scale(1.05); }

    /* â”€â”€ DOT LOADER â”€â”€ */
    .dot-loader { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 52px; }
    .dot-loader span {
      width: 6px; height: 6px; border-radius: var(--r-full); background: var(--text-3);
      animation: dotPulse 1.2s ease-in-out infinite;
    }
    .dot-loader span:nth-child(2) { animation-delay: .2s; }
    .dot-loader span:nth-child(3) { animation-delay: .4s; }
    @keyframes dotPulse {
      0%,80%,100% { transform: scale(.6); opacity: .3; }
      40%          { transform: scale(1);  opacity: 1; }
    }

    /* â”€â”€ TOAST â”€â”€ */
    #toast {
      position: fixed; bottom: 24px; right: 24px;
      background: var(--bg-overlay); border: 1px solid var(--border-def);
      color: var(--text-1); padding: 11px 16px; border-radius: var(--r-lg);
      font-size: 14px; font-weight: 500; box-shadow: var(--sh-lg);
      transform: translateY(100px); opacity: 0;
      transition: transform .3s cubic-bezier(.34,1.56,.64,1), opacity .2s;
      z-index: 999; max-width: 340px; display: flex; align-items: center; gap: 10px;
    }
    #toast.show { transform: translateY(0); opacity: 1; }
    .toast-dot { width: 6px; height: 6px; border-radius: var(--r-full); background: var(--text-3); flex-shrink: 0; }
    #toast.success .toast-dot { background: var(--success); }
    #toast.error   .toast-dot { background: var(--danger); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTH
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .auth-wrap {
      min-height: calc(100vh - 56px);
      display: flex; align-items: center; justify-content: center;
      padding: 40px 16px; position: relative; overflow: hidden;
    }
    .auth-glow {
      position: fixed; top: -10%; left: 50%; transform: translateX(-50%);
      width: 800px; height: 800px; pointer-events: none; z-index: 0;
      background: conic-gradient(
        from 0deg,
        rgba(249,115,22,.10), rgba(234,179,8,.10), rgba(34,197,94,.10),
        rgba(6,182,212,.10),  rgba(99,102,241,.10), rgba(168,85,247,.10),
        rgba(236,72,153,.10), rgba(249,115,22,.10)
      );
      border-radius: 50%;
      animation: hueRotate 8s linear infinite;
    }
    .auth-card {
      background: var(--bg-surface); border: 1px solid var(--border-def);
      border-radius: var(--r-xl); padding: 36px 32px; width: 100%; max-width: 420px;
      box-shadow: var(--sh-lg), 0 0 0 1px rgba(255,255,255,.03) inset;
      position: relative; z-index: 1;
    }
    /* Rainbow shimmer border on auth card */
    .auth-card::before {
      content: '';
      position: absolute; inset: -1px; border-radius: calc(var(--r-xl) + 1px);
      background: var(--grad-nav);
      background-size: 300% 300%;
      animation: rainbowShift 4s linear infinite;
      z-index: -1;
    }
    .auth-brand-row { display: flex; align-items: center; gap: 10px; margin-bottom: 28px; }
    .auth-brand-name {
      font-size: 17px; font-weight: 700; letter-spacing: -.03em;
      background: var(--grad-nav); background-size: 200% auto;
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; animation: rainbowShift 4s linear infinite;
    }
    .auth-card h2 {
      font-size: 22px; font-weight: 700; letter-spacing: -.035em;
      color: var(--text-1); margin-bottom: 4px;
    }
    .auth-card .subtitle { color: var(--text-2); font-size: 14px; margin-bottom: 28px; }
    /* pill tab switcher */
    .tabs {
      display: flex; background: var(--bg-elevated); border: 1px solid var(--border-def);
      border-radius: var(--r-md); padding: 3px; margin-bottom: 24px; gap: 2px;
    }
    .tab-btn {
      flex: 1; padding: 7px 12px; background: transparent; border: none;
      border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;
      font-family: var(--font); color: var(--text-2); transition: all .18s;
    }
    .tab-btn.active { background: var(--bg-surface); color: var(--text-1); box-shadow: var(--sh-sm); }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUESTIONS LIST
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page-header {
      display: flex; align-items: flex-start; justify-content: space-between;
      margin-bottom: 20px; gap: 12px;
    }
    .page-header h1 {
      font-size: 22px; font-weight: 700; letter-spacing: -.025em; margin-bottom: 3px;
      background: var(--grad-nav); background-size: 200% auto;
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; animation: rainbowShift 5s linear infinite;
    }
    .question-count { color: var(--text-3); font-size: 13px; }
    .search-wrap { position: relative; margin-bottom: 16px; }
    .search-icon {
      position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
      color: var(--text-3); pointer-events: none; display: flex;
    }
    .search-wrap input { padding-left: 38px; }
    .question-list { display: flex; flex-direction: column; gap: 8px; }
    .question-card {
      background: var(--bg-surface); border: 1px solid var(--border-def);
      border-radius: var(--r-lg); padding: 16px 20px;
      display: grid; grid-template-columns: 64px 1fr; gap: 16px;
      cursor: pointer; transition: background .15s, border-color .15s, transform .15s, box-shadow .15s;
    }
    .question-card:hover {
      background: var(--bg-elevated); border-color: var(--border-strong);
      transform: translateY(-2px); box-shadow: var(--sh-md);
    }
    /* Rainbow left accent border per card â€” cycle 7 colors */
    .question-card::before {
      content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
      border-radius: var(--r-lg) 0 0 var(--r-lg);
    }
    .question-card { position: relative; overflow: hidden; }
    .question-card:nth-child(7n+1)::before { background: #f97316; }
    .question-card:nth-child(7n+2)::before { background: #eab308; }
    .question-card:nth-child(7n+3)::before { background: #22c55e; }
    .question-card:nth-child(7n+4)::before { background: #06b6d4; }
    .question-card:nth-child(7n+5)::before { background: #6366f1; }
    .question-card:nth-child(7n+6)::before { background: #a855f7; }
    .question-card:nth-child(7n+0)::before { background: #ec4899; }
    .q-stats {
      display: flex; flex-direction: column; align-items: flex-end; gap: 8px;
      padding-right: 16px; border-right: 1px solid var(--border-subtle);
    }
    .stat-box { text-align: right; }
    .stat-box .num {
      display: block; font-size: 17px; font-weight: 600; color: var(--text-1);
      letter-spacing: -.02em; line-height: 1.2; font-family: var(--mono);
    }
    .stat-box .lbl { font-size: 10px; color: var(--text-3); text-transform: uppercase; letter-spacing: .05em; font-weight: 500; }
    .q-content { min-width: 0; }
    .q-title {
      font-size: 15px; font-weight: 500; color: var(--text-1); margin-bottom: 5px;
      line-height: 1.45; letter-spacing: -.01em; transition: color .12s;
    }
    .question-card:hover .q-title { color: var(--accent-hov); }
    .q-body {
      font-size: 13px; color: var(--text-2); margin-bottom: 10px;
      overflow: hidden; display: -webkit-box;
      -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.55;
    }
    .q-footer { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
    .q-meta { margin-left: auto; font-size: 12px; color: var(--text-3); white-space: nowrap; }
    /* empty */
    .empty-state { text-align: center; padding: 80px 20px; }
    .empty-icon { width: 44px; height: 44px; color: var(--text-3); margin: 0 auto 16px; }
    .empty-state h3 { font-size: 16px; font-weight: 600; letter-spacing: -.02em; margin-bottom: 6px; }
    .empty-state p  { font-size: 14px; color: var(--text-2); margin-bottom: 24px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BREADCRUMB
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .detail-nav { display: flex; align-items: center; gap: 8px; margin-bottom: 24px; font-size: 13px; }
    .detail-nav a { color: var(--text-2); cursor: pointer; text-decoration: none; transition: color .12s; }
    .detail-nav a:hover { color: var(--text-1); }
    .bc-sep { color: var(--text-3); font-family: var(--mono); font-size: 12px; }
    .bc-cur { color: var(--text-3); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 360px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ASK QUESTION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ask-layout { display: grid; grid-template-columns: 1fr 296px; gap: 20px; align-items: start; }
    .ask-card {
      background: var(--bg-surface); border: 1px solid var(--border-def);
      border-radius: var(--r-xl); padding: 28px 32px;
    }
    .ask-card h1 { font-size: 22px; font-weight: 700; letter-spacing: -.03em; margin-bottom: 4px; }
    .ask-card .subtitle { color: var(--text-2); font-size: 14px; margin-bottom: 28px; }
    .ask-actions { display: flex; gap: 8px; margin-top: 24px; }
    .tag-hint { font-size: 12px; color: var(--text-3); margin-top: 5px; }
    .tag-hint span { color: var(--accent); font-family: var(--mono); }
    /* tips sidebar */
    .tips-panel { position: sticky; top: 76px; }
    .tips-card {
      background: var(--bg-elevated); border: 1px solid var(--border-def);
      border-radius: var(--r-lg); padding: 20px;
    }
    .tips-card h4 {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: .07em; color: var(--text-3); margin-bottom: 14px;
    }
    .tips-list { list-style: none; display: flex; flex-direction: column; gap: 10px; }
    .tips-list li {
      font-size: 13px; color: var(--text-2); line-height: 1.55;
      padding-left: 16px; position: relative;
    }
    .tips-list li::before { content: 'â€”'; position: absolute; left: 0; color: var(--accent); font-family: var(--mono); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUESTION DETAIL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .question-detail-card {
      background: var(--bg-surface); border: 1px solid var(--border-def);
      border-radius: var(--r-xl); overflow: hidden; margin-bottom: 20px;
    }
    .question-detail-header { padding: 24px 28px 20px; border-bottom: 1px solid var(--border-subtle); }
    .question-detail-title {
      font-size: 22px; font-weight: 700; letter-spacing: -.035em;
      line-height: 1.3; color: var(--text-1); margin-bottom: 12px;
    }
    .question-meta-row { display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-2); flex-wrap: wrap; }
    .meta-sep { color: var(--border-strong); }
    .question-detail-body { display: flex; gap: 0; padding: 24px 28px; }
    .vote-col {
      display: flex; flex-direction: column; align-items: center; gap: 6px;
      padding-right: 24px; border-right: 1px solid var(--border-subtle);
      margin-right: 24px; flex-shrink: 0;
    }
    .vote-btn {
      width: 34px; height: 34px; border-radius: var(--r-full);
      border: 1px solid var(--vote-ring); background: var(--bg-elevated);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      color: var(--text-2); transition: all .15s;
    }
    .vote-btn.up:hover   { border-color: var(--vote-up);   color: var(--vote-up);   background: rgba(52,211,153,.08); }
    .vote-btn.down:hover { border-color: var(--vote-down); color: var(--vote-down); background: rgba(248,113,113,.08); }
    .vote-count {
      font-size: 18px; font-weight: 700; color: var(--text-1);
      letter-spacing: -.02em; font-family: var(--mono); min-width: 32px; text-align: center;
    }
    .body-text { flex: 1; font-size: 15px; line-height: 1.75; color: var(--text-1); white-space: pre-wrap; word-break: break-word; }
    .question-detail-footer {
      padding: 12px 28px; background: var(--bg-elevated);
      border-top: 1px solid var(--border-subtle); display: flex; gap: 6px; align-items: center; flex-wrap: wrap;
    }
    /* answers */
    .answers-section { margin-bottom: 20px; }
    .answers-header {
      display: flex; align-items: center; gap: 10px;
      font-size: 17px; font-weight: 600; letter-spacing: -.02em; margin-bottom: 14px;
    }
    .answers-count {
      background: var(--grad-btn); background-size: 200% auto;
      animation: rainbowShift 3s linear infinite;
      color: #fff; border: none;
      border-radius: var(--r-full); padding: 2px 10px; font-size: 12px; font-weight: 700; font-family: var(--mono);
    }
    .answer-card {
      background: var(--bg-surface); border: 1px solid var(--border-def);
      border-radius: var(--r-lg); overflow: hidden; margin-bottom: 10px;
    }
    .answer-card.accepted {
      border-color: rgba(52,211,153,.35);
      background: linear-gradient(180deg, rgba(52,211,153,.04) 0%, var(--bg-surface) 60px);
    }
    .answer-body-wrap { display: flex; gap: 0; padding: 20px 24px; }
    .accepted-badge {
      display: inline-flex; align-items: center; gap: 5px;
      background: linear-gradient(90deg,#22c55e,#06b6d4); color: #fff;
      border: none; font-size: 11px; font-weight: 700;
      padding: 3px 10px; border-radius: var(--r-sm); letter-spacing: .01em;
      box-shadow: 0 2px 8px rgba(34,197,94,.3);
    }
    .answer-footer {
      padding: 10px 24px; background: var(--bg-elevated); border-top: 1px solid var(--border-subtle);
      display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-2);
    }
    .answer-footer .btn { margin-left: auto; }
    /* post answer */
    .post-answer-card {
      background: var(--bg-surface); border: 1px solid var(--border-def);
      border-radius: var(--r-xl); padding: 28px 32px;
    }
    .post-answer-divider {
      display: flex; align-items: center; gap: 12px; margin-bottom: 24px;
    }
    .post-answer-divider::before, .post-answer-divider::after {
      content: ''; flex: 1; height: 1px;
      background: var(--grad-nav); background-size: 200% auto;
      animation: rainbowShift 5s linear infinite;
    }
    .post-answer-divider span {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: .07em; color: var(--text-3); white-space: nowrap;
    }

    /* â”€â”€ RESPONSIVE â”€â”€ */
    @media (max-width: 800px) {
      .ask-layout { grid-template-columns: 1fr; }
      .tips-panel { display: none; }
    }
    @media (max-width: 640px) {
      .question-card { grid-template-columns: 1fr; }
      .q-stats { flex-direction: row; border-right: none; border-bottom: 1px solid var(--border-subtle); padding-right: 0; padding-bottom: 10px; }
      .question-detail-body, .answer-body-wrap { flex-direction: column; }
      .vote-col { flex-direction: row; border-right: none; border-bottom: 1px solid var(--border-subtle); margin-right: 0; margin-bottom: 16px; padding-right: 0; padding-bottom: 12px; }
      .question-detail-title { font-size: 18px; }
      .auth-card { padding: 24px 20px; }
      .ask-card, .post-answer-card { padding: 20px; }
      .nav-username { display: none; }
    }
  </style>
</head>
<body>

<!-- â•â• NAV â•â• -->
<nav>
  <div class="nav-inner">
    <span class="nav-brand" onclick="goHome()">
      <svg width="26" height="26" viewBox="0 0 26 26" fill="none">
        <rect width="26" height="26" rx="7" fill="url(#ng)"/>
        <defs>
          <linearGradient id="ng" x1="0" y1="0" x2="26" y2="26">
            <stop offset="0%" stop-color="#9585f9"/><stop offset="100%" stop-color="#5b4fd4"/>
          </linearGradient>
        </defs>
        <path d="M7 19L13 7L19 19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M9.5 14.5h7" stroke="white" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Threadline
    </span>
    <div class="nav-spacer"></div>
    <div class="nav-right">
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <svg id="theme-icon" width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
          <path d="M14 10.5A6.5 6.5 0 1 1 5.5 2a5 5 0 0 0 8.5 8.5z"/>
        </svg>
      </button>
      <div class="nav-user" id="navUser" style="display:none;">
        <div class="avatar" id="navAvatar"></div>
        <span class="nav-username" id="navUsername"></span>
        <button class="btn-logout" onclick="logout()">Sign out</button>
      </div>
    </div>
  </div>
</nav>

<!-- â•â• AUTH PAGE â•â• -->
<div class="page active" id="page-auth">
  <div class="auth-wrap">
    <div class="auth-glow"></div>
    <div class="auth-card">
      <div class="auth-brand-row">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="9" fill="url(#ag)"/>
          <defs>
            <linearGradient id="ag" x1="0" y1="0" x2="32" y2="32">
              <stop offset="0%" stop-color="#9585f9"/><stop offset="100%" stop-color="#5b4fd4"/>
            </linearGradient>
          </defs>
          <path d="M8 24L16 8L24 24" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M11 18.5h10" stroke="white" stroke-width="2.2" stroke-linecap="round"/>
        </svg>
        <span class="auth-brand-name">Threadline</span>
      </div>
      <h2>Welcome back</h2>
      <p class="subtitle">Sign in to ask questions and share knowledge</p>

      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('login')">Sign In</button>
        <button class="tab-btn" onclick="switchTab('register')">Create Account</button>
      </div>

      <!-- LOGIN -->
      <div class="tab-panel active" id="tab-login">
        <div class="alert alert-error" id="login-error"></div>
        <div class="form-group">
          <label for="login-username">Username</label>
          <input type="text" id="login-username" placeholder="Enter your username" autocomplete="username" />
        </div>
        <button class="btn btn-primary btn-full" id="login-btn" onclick="doLogin()">Sign In</button>
        <p style="margin-top:16px;font-size:13px;color:var(--text-3);text-align:center;">
          No account? <a href="#" onclick="switchTab('register')" style="color:var(--accent);">Create one</a>
        </p>
      </div>

      <!-- REGISTER -->
      <div class="tab-panel" id="tab-register">
        <div class="alert alert-error"   id="register-error"></div>
        <div class="alert alert-success" id="register-success"></div>
        <div class="form-group">
          <label for="reg-username">Username <span class="req">*</span></label>
          <input type="text" id="reg-username" placeholder="e.g. johndoe" autocomplete="username" />
        </div>
        <div class="form-group">
          <label for="reg-displayname">Display Name <span class="req">*</span></label>
          <input type="text" id="reg-displayname" placeholder="e.g. John Doe" autocomplete="name" />
        </div>
        <div class="form-group">
          <label for="reg-email">Email <span class="req">*</span></label>
          <input type="email" id="reg-email" placeholder="e.g. john@example.com" autocomplete="email" />
        </div>
        <button class="btn btn-primary btn-full" id="register-btn" onclick="doRegister()">Create Account</button>
        <p style="margin-top:16px;font-size:13px;color:var(--text-3);text-align:center;">
          Already have an account? <a href="#" onclick="switchTab('login')" style="color:var(--accent);">Sign in</a>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- â•â• QUESTIONS LIST â•â• -->
<div class="page" id="page-questions">
  <div class="container">
    <div class="page-header">
      <div>
        <h1>All Questions</h1>
        <div class="question-count" id="q-count"></div>
      </div>
      <button class="btn btn-primary" onclick="showAskPage()">
        <svg width="13" height="13" viewBox="0 0 13 13" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"><path d="M6.5 1v11M1 6.5h11"/></svg>
        Ask Question
      </button>
    </div>

    <div class="search-wrap">
      <span class="search-icon">
        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
          <circle cx="6.5" cy="6.5" r="4.5"/><path d="m10.5 10.5 2.5 2.5"/>
        </svg>
      </span>
      <input type="text" id="search-input" placeholder="Search by title, content or tagâ€¦" oninput="filterQuestions()" />
    </div>

    <div id="questions-loading" class="dot-loader"><span></span><span></span><span></span></div>
    <div class="question-list" id="question-list"></div>
    <div class="empty-state" id="questions-empty" style="display:none;">
      <svg class="empty-icon" viewBox="0 0 44 44" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round">
        <circle cx="22" cy="22" r="18"/><path d="M22 14v8M22 30v.5"/>
      </svg>
      <h3>No questions yet</h3>
      <p>Be the first to ask something!</p>
      <button class="btn btn-primary" onclick="showAskPage()">Ask a Question</button>
    </div>
  </div>
</div>

<!-- â•â• ASK QUESTION â•â• -->
<div class="page" id="page-ask">
  <div class="container">
    <div class="detail-nav">
      <a onclick="showQuestionsPage()">Questions</a>
      <span class="bc-sep">/</span>
      <span class="bc-cur">Ask a Question</span>
    </div>
    <div class="ask-layout">
      <div class="ask-card">
        <h1>Ask a Question</h1>
        <p class="subtitle">Be specific and clear â€” good questions get great answers faster</p>
        <div class="alert alert-error" id="ask-error"></div>
        <div class="form-group">
          <div class="form-label-row">
            <label for="ask-title">Title <span class="req">*</span></label>
            <span class="char-count" id="title-char-count">0 / 150</span>
          </div>
          <input type="text" id="ask-title" maxlength="150" placeholder="What's your question? Be specific." oninput="updateCharCount()" />
        </div>
        <div class="form-group">
          <label for="ask-body">Body <span class="req">*</span></label>
          <textarea id="ask-body" rows="8" placeholder="Describe your problem in detail. Include what you've tried and what you expected."></textarea>
        </div>
        <div class="form-group">
          <label for="ask-tags">Tags</label>
          <input type="text" id="ask-tags" placeholder="e.g. java, spring, mongodb  (comma separated)" />
          <div class="tag-hint">Add up to <span>5</span> tags to help others find your question</div>
        </div>
        <div class="ask-actions">
          <button class="btn btn-primary" id="ask-submit-btn" onclick="submitQuestion()">Post Question</button>
          <button class="btn btn-ghost"   onclick="showQuestionsPage()">Cancel</button>
        </div>
      </div>
      <div class="tips-panel">
        <div class="tips-card">
          <h4>Writing a good question</h4>
          <ul class="tips-list">
            <li>Summarize your problem in one clear sentence for the title</li>
            <li>Describe what you tried and what happened vs. expected</li>
            <li>Include relevant code, errors, or config snippets</li>
            <li>Use specific tags so the right people find it</li>
            <li>Search first â€” it may already be answered</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â• QUESTION DETAIL â•â• -->
<div class="page" id="page-detail">
  <div class="container">
    <div class="detail-nav">
      <a onclick="showQuestionsPage()">Questions</a>
      <span class="bc-sep">/</span>
      <span class="bc-cur" id="detail-breadcrumb"></span>
    </div>

    <div id="detail-loading" class="dot-loader"><span></span><span></span><span></span></div>
    <div id="detail-content" style="display:none;">

      <div class="question-detail-card">
        <div class="question-detail-header">
          <div class="question-detail-title" id="detail-title"></div>
          <div class="question-meta-row">
            <span>Asked by <strong id="detail-author" style="color:var(--text-1);font-weight:500;"></strong></span>
            <span class="meta-sep">Â·</span>
            <span id="detail-date"></span>
          </div>
        </div>
        <div class="question-detail-body">
          <div class="vote-col">
            <button class="vote-btn up" onclick="voteQuestion(1)" title="Vote up">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 11V3M3 7l4-4 4 4"/></svg>
            </button>
            <div class="vote-count" id="detail-votes">0</div>
            <button class="vote-btn down" onclick="voteQuestion(-1)" title="Vote down">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 3v8M3 7l4 4 4-4"/></svg>
            </button>
          </div>
          <div class="body-text" id="detail-body"></div>
        </div>
        <div class="question-detail-footer" id="detail-tags-row"></div>
      </div>

      <div class="answers-section">
        <div class="answers-header">
          Answers <span class="answers-count" id="answers-count">0</span>
        </div>
        <div id="answers-loading" class="dot-loader" style="display:none;"><span></span><span></span><span></span></div>
        <div id="answers-list"></div>
        <div class="empty-state" id="answers-empty" style="display:none; padding:32px 0;">
          <svg class="empty-icon" viewBox="0 0 44 44" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
            <path d="M38 6H6a2 2 0 0 0-2 2v22a2 2 0 0 0 2 2h8l8 8 8-8h8a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2z"/>
            <path d="M14 18h16M14 25h10"/>
          </svg>
          <h3>No answers yet</h3>
          <p>Be the first to answer this question</p>
        </div>
      </div>

      <div class="post-answer-card">
        <div class="post-answer-divider"><span>Your Answer</span></div>
        <div class="alert alert-error" id="answer-error"></div>
        <div class="form-group">
          <textarea id="answer-body" rows="6" placeholder="Write a clear, detailed answer. Include examples or code where helpful."></textarea>
        </div>
        <button class="btn btn-primary" id="answer-submit-btn" onclick="submitAnswer()">Post Answer</button>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"><span class="toast-dot"></span><span id="toast-msg"></span></div>

<script>
  const API = '';
  let currentUser = null, allQuestions = [], currentQuestion = null;

  /* â”€â”€ INIT â”€â”€ */
  (function init() {
    if (localStorage.getItem('theme') === 'light') { document.documentElement.classList.add('light'); updateThemeIcon(); }
    const saved = sessionStorage.getItem('qa_user');
    if (saved) { currentUser = JSON.parse(saved); updateNav(); showQuestionsPage(); }
  })();

  /* â”€â”€ THEME â”€â”€ */
  function toggleTheme() {
    document.documentElement.classList.toggle('light');
    localStorage.setItem('theme', document.documentElement.classList.contains('light') ? 'light' : 'dark');
    updateThemeIcon();
  }
  function updateThemeIcon() {
    const light = document.documentElement.classList.contains('light');
    document.getElementById('theme-icon').innerHTML = light
      ? `<circle cx="8" cy="8" r="4"/><path d="M8 1v1.5M8 13.5V15M1 8h1.5M13.5 8H15M3.4 3.4l1 1M10.6 10.6l1 1M3.4 12.6l1-1M10.6 5.4l1-1" stroke-linecap="round"/>`
      : `<path d="M14 10.5A6.5 6.5 0 1 1 5.5 2a5 5 0 0 0 8.5 8.5z"/>`;
  }

  /* â”€â”€ ROUTING â”€â”€ */
  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + id).classList.add('active');
    window.scrollTo(0, 0);
  }
  function goHome() { currentUser ? showQuestionsPage() : showPage('auth'); }
  function showQuestionsPage() { showPage('questions'); loadQuestions(); }
  function showAskPage() {
    showPage('ask');
    ['ask-title','ask-body','ask-tags'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('title-char-count').textContent = '0 / 150';
    hideAlert('ask-error');
  }
  function showDetailPage(q) {
    currentQuestion = q; showPage('detail');
    document.getElementById('detail-loading').style.display = 'none';
    document.getElementById('detail-content').style.display = 'block';
    renderQuestionDetail(q); loadAnswers(q.id);
  }

  /* â”€â”€ NAV â”€â”€ */
  function updateNav() {
    if (currentUser) {
      document.getElementById('navUser').style.display = 'flex';
      document.getElementById('navAvatar').textContent = (currentUser.displayName || currentUser.username)[0].toUpperCase();
      document.getElementById('navUsername').textContent = currentUser.displayName || currentUser.username;
    } else { document.getElementById('navUser').style.display = 'none'; }
  }
  function logout() {
    currentUser = null; sessionStorage.removeItem('qa_user'); allQuestions = [];
    updateNav(); showPage('auth'); switchTab('login');
  }

  /* â”€â”€ TABS â”€â”€ */
  function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach((b, i) =>
      b.classList.toggle('active', i === 0 ? tab === 'login' : tab === 'register'));
    document.getElementById('tab-login').classList.toggle('active', tab === 'login');
    document.getElementById('tab-register').classList.toggle('active', tab === 'register');
  }

  /* â”€â”€ API â”€â”€ */
  async function apiFetch(path, opts = {}) {
    const res = await fetch(API + path, { headers: { 'Content-Type': 'application/json', ...(opts.headers||{}) }, ...opts });
    if (!res.ok) { let m = `HTTP ${res.status}`; try { const b = await res.json(); m = b.message||b.error||m; } catch(_){} throw new Error(m); }
    if (res.status === 204) return null;
    return res.json();
  }

  /* â”€â”€ AUTH â”€â”€ */
  async function doLogin() {
    hideAlert('login-error');
    const username = document.getElementById('login-username').value.trim();
    if (!username) { showAlert('login-error', 'Please enter your username.'); return; }
    setLoading('login-btn', true, 'Signing inâ€¦');
    try {
      const user = await apiFetch('/api/users/login', { method: 'POST', body: JSON.stringify({ username }) });
      currentUser = user; sessionStorage.setItem('qa_user', JSON.stringify(user));
      updateNav(); showQuestionsPage();
      toast('Welcome back, ' + (user.displayName || user.username) + '!', 'success');
    } catch(e) { showAlert('login-error', e.message.includes('401') ? 'User not found. Check your username.' : e.message); }
    finally { setLoading('login-btn', false, 'Sign In'); }
  }

  async function doRegister() {
    hideAlert('register-error'); hideAlert('register-success');
    const username = document.getElementById('reg-username').value.trim();
    const displayName = document.getElementById('reg-displayname').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    if (!username || !displayName || !email) { showAlert('register-error', 'All fields are required.'); return; }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showAlert('register-error', 'Please enter a valid email address.'); return; }
    setLoading('register-btn', true, 'Creating accountâ€¦');
    try {
      await apiFetch('/api/users', { method: 'POST', body: JSON.stringify({ username, displayName, email }) });
      showAlert('register-success', 'Account created! You can now sign in.');
      ['reg-username','reg-displayname','reg-email'].forEach(id => document.getElementById(id).value = '');
      setTimeout(() => switchTab('login'), 1400);
    } catch(e) { showAlert('register-error', 'Registration failed: ' + e.message); }
    finally { setLoading('register-btn', false, 'Create Account'); }
  }

  document.getElementById('login-username').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
  document.getElementById('reg-email').addEventListener('keydown',    e => { if (e.key === 'Enter') doRegister(); });

  /* â”€â”€ QUESTIONS LIST â”€â”€ */
  async function loadQuestions() {
    document.getElementById('questions-loading').style.display = 'flex';
    document.getElementById('question-list').innerHTML = '';
    document.getElementById('questions-empty').style.display = 'none';
    try { allQuestions = await apiFetch('/api/questions'); renderQuestions(allQuestions); }
    catch(e) { toast('Failed to load questions: ' + e.message, 'error'); }
    finally { document.getElementById('questions-loading').style.display = 'none'; }
  }

  function renderQuestions(questions) {
    const list = document.getElementById('question-list'), empty = document.getElementById('questions-empty');
    document.getElementById('q-count').textContent = questions.length + ' question' + (questions.length !== 1 ? 's' : '');
    if (!questions.length) { list.innerHTML = ''; empty.style.display = 'block'; return; }
    empty.style.display = 'none';
    list.innerHTML = questions.map(q => `
      <div class="question-card" onclick="openQuestion('${q.id}')">
        <div class="q-stats">
          <div class="stat-box"><span class="num">${q.votes||0}</span><span class="lbl">votes</span></div>
        </div>
        <div class="q-content">
          <div class="q-title">${escHtml(q.title)}</div>
          <div class="q-body">${escHtml(q.body||'')}</div>
          <div class="q-footer">
            ${(q.tags||[]).map(t=>`<span class="tag">${escHtml(t)}</span>`).join('')}
            <span class="q-meta">${relativeTime(q.createdAt)}</span>
          </div>
        </div>
      </div>`).join('');
  }

  function filterQuestions() {
    const q = document.getElementById('search-input').value.toLowerCase();
    if (!q) { renderQuestions(allQuestions); return; }
    renderQuestions(allQuestions.filter(item =>
      (item.title||'').toLowerCase().includes(q) ||
      (item.body||'').toLowerCase().includes(q) ||
      (item.tags||[]).some(t => t.toLowerCase().includes(q))));
  }

  async function openQuestion(id) {
    const cached = allQuestions.find(q => q.id === id);
    if (cached) { showDetailPage(cached); return; }
    try { showDetailPage(await apiFetch('/api/questions/' + id)); }
    catch(e) { toast('Could not load question: ' + e.message, 'error'); }
  }

  /* â”€â”€ QUESTION DETAIL â”€â”€ */
  function renderQuestionDetail(q) {
    document.getElementById('detail-breadcrumb').textContent = q.title;
    document.getElementById('detail-title').textContent     = q.title;
    document.getElementById('detail-author').textContent    = q.authorId || 'Anonymous';
    document.getElementById('detail-date').textContent      = formatDate(q.createdAt);
    document.getElementById('detail-votes').textContent     = q.votes || 0;
    document.getElementById('detail-body').textContent      = q.body || '';
    const tr = document.getElementById('detail-tags-row');
    tr.innerHTML = (q.tags||[]).map(t=>`<span class="tag">${escHtml(t)}</span>`).join('') || `<span style="color:var(--text-3);font-size:13px;">No tags</span>`;
    document.getElementById('answer-body').value = ''; hideAlert('answer-error');
  }

  async function voteQuestion(delta) {
    if (!currentQuestion) return;
    try {
      const up = await apiFetch('/api/questions/' + currentQuestion.id, {
        method: 'PUT', body: JSON.stringify({ ...currentQuestion, votes: (currentQuestion.votes||0) + delta })
      });
      currentQuestion = up; document.getElementById('detail-votes').textContent = up.votes;
      const idx = allQuestions.findIndex(q => q.id === up.id);
      if (idx !== -1) allQuestions[idx] = up;
    } catch(e) { toast('Vote failed: ' + e.message, 'error'); }
  }

  /* â”€â”€ ANSWERS â”€â”€ */
  async function loadAnswers(questionId) {
    document.getElementById('answers-loading').style.display = 'flex';
    document.getElementById('answers-list').innerHTML = '';
    document.getElementById('answers-empty').style.display = 'none';
    try { renderAnswers(await apiFetch('/api/questions/' + questionId + '/answers')); }
    catch(e) { toast('Failed to load answers: ' + e.message, 'error'); }
    finally { document.getElementById('answers-loading').style.display = 'none'; }
  }

  function renderAnswers(answers) {
    const list = document.getElementById('answers-list'), empty = document.getElementById('answers-empty');
    document.getElementById('answers-count').textContent = answers.length;
    if (!answers.length) { list.innerHTML = ''; empty.style.display = 'block'; return; }
    empty.style.display = 'none';
    const sorted = [...answers].sort((a,b) => {
      if (a.accepted && !b.accepted) return -1; if (!a.accepted && b.accepted) return 1;
      return (b.votes||0)-(a.votes||0);
    });
    const upSvg   = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 11V3M3 7l4-4 4 4"/></svg>`;
    const downSvg = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 3v8M3 7l4 4 4-4"/></svg>`;
    const chkSvg  = `<svg width="10" height="10" viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1.5 5l2.5 2.5L8.5 2.5"/></svg>`;
    list.innerHTML = sorted.map(a => `
      <div class="answer-card ${a.accepted?'accepted':''}" id="answer-${a.id}">
        <div class="answer-body-wrap">
          <div class="vote-col">
            <button class="vote-btn up"   onclick="voteAnswer('${a.id}',1)">${upSvg}</button>
            <div class="vote-count">${a.votes||0}</div>
            <button class="vote-btn down" onclick="voteAnswer('${a.id}',-1)">${downSvg}</button>
          </div>
          <div class="body-text">${escHtml(a.body||'')}</div>
        </div>
        <div class="answer-footer">
          ${a.accepted ? `<span class="accepted-badge">${chkSvg} Accepted</span>` : ''}
          <span>By <strong style="color:var(--text-1);font-weight:500;">${escHtml(a.authorId||'Anonymous')}</strong> Â· ${relativeTime(a.createdAt)}</span>
          ${!a.accepted ? `<button class="btn btn-sm btn-outline" onclick="acceptAnswer('${a.id}')">Accept</button>` : ''}
        </div>
      </div>`).join('');
  }

  async function voteAnswer(id, delta) {
    try {
      const up = await apiFetch('/api/answers/'+id+'/vote', { method:'PUT', body: JSON.stringify({delta}) });
      const card = document.getElementById('answer-'+id);
      if (card) card.querySelector('.vote-count').textContent = up.votes;
    } catch(e) { toast('Vote failed: ' + e.message, 'error'); }
  }

  async function acceptAnswer(id) {
    try { await apiFetch('/api/answers/'+id+'/accept', {method:'PUT'}); toast('Answer accepted!','success'); loadAnswers(currentQuestion.id); }
    catch(e) { toast('Could not accept: ' + e.message, 'error'); }
  }

  async function submitAnswer() {
    hideAlert('answer-error');
    const body = document.getElementById('answer-body').value.trim();
    if (!body) { showAlert('answer-error', 'Please write an answer before posting.'); return; }
    setLoading('answer-submit-btn', true, 'Postingâ€¦');
    try {
      await apiFetch('/api/questions/'+currentQuestion.id+'/answers', {
        method:'POST', body: JSON.stringify({ body, authorId: currentUser?.id||currentUser?.username||'anonymous', questionId: currentQuestion.id })
      });
      document.getElementById('answer-body').value = '';
      toast('Answer posted!', 'success'); loadAnswers(currentQuestion.id);
    } catch(e) { showAlert('answer-error', 'Failed to post: ' + e.message); }
    finally { setLoading('answer-submit-btn', false, 'Post Answer'); }
  }

  /* â”€â”€ ASK QUESTION â”€â”€ */
  function updateCharCount() {
    const len = document.getElementById('ask-title').value.length;
    const el = document.getElementById('title-char-count');
    el.textContent = len + ' / 150';
    el.className = 'char-count' + (len > 130 ? ' warn' : '');
  }

  async function submitQuestion() {
    hideAlert('ask-error');
    const title = document.getElementById('ask-title').value.trim();
    const body  = document.getElementById('ask-body').value.trim();
    const raw   = document.getElementById('ask-tags').value.trim();
    if (!title) { showAlert('ask-error', 'Title is required.'); return; }
    if (!body)  { showAlert('ask-error', 'Body is required.');  return; }
    const tags = raw ? raw.split(',').map(t=>t.trim()).filter(Boolean).slice(0,5) : [];
    setLoading('ask-submit-btn', true, 'Postingâ€¦');
    try {
      const created = await apiFetch('/api/questions', {
        method:'POST', body: JSON.stringify({ title, body, tags, authorId: currentUser?.id||currentUser?.username||'anonymous' })
      });
      toast('Question posted!', 'success'); allQuestions.unshift(created); showDetailPage(created);
    } catch(e) { showAlert('ask-error', 'Failed to post: ' + e.message); }
    finally { setLoading('ask-submit-btn', false, 'Post Question'); }
  }

  /* â”€â”€ HELPERS â”€â”€ */
  function showAlert(id,msg) { const el=document.getElementById(id); el.textContent=msg; el.classList.add('show'); }
  function hideAlert(id)     { document.getElementById(id).classList.remove('show'); }
  function setLoading(id,on,label) { const b=document.getElementById(id); b.disabled=on; b.textContent=label; }

  let _tt;
  function toast(msg, type='') {
    const el=document.getElementById('toast');
    document.getElementById('toast-msg').textContent = msg;
    el.className = 'show' + (type?' '+type:'');
    clearTimeout(_tt); _tt = setTimeout(()=>{ el.className=''; }, 3200);
  }

  function escHtml(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
  function relativeTime(iso) {
    if (!iso) return '';
    const d=Date.now()-new Date(iso).getTime(), m=Math.floor(d/60000);
    if (m<1) return 'just now'; if (m<60) return m+'m ago';
    const h=Math.floor(m/60); if (h<24) return h+'h ago';
    const dy=Math.floor(h/24); if (dy<7) return dy+'d ago';
    return formatDate(iso);
  }
  function formatDate(iso) {
    if (!iso) return '';
    return new Date(iso).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
  }
</script>
</body>
</html>
